---
layout: post
title: Pulumiæ¶æ„åŠä½¿ç”¨
catalog: true
tag: [DevOps, OpenStack, MultiStack]
---


<!-- TOC -->

- [1. pulumiä»‹ç»](#1-pulumiä»‹ç»)
- [2. pulumiè¿è¡Œæœºåˆ¶](#2-pulumiè¿è¡Œæœºåˆ¶)
	- [2.1. æœ¯è¯­](#21-æœ¯è¯­)
	- [2.2. ç³»ç»Ÿæ¶æ„](#22-ç³»ç»Ÿæ¶æ„)
	- [2.3. é€»è¾‘æ¶æ„](#23-é€»è¾‘æ¶æ„)
		- [2.3.1. pulumi cli ç¤ºä¾‹](#231-pulumi-cli-ç¤ºä¾‹)
		- [2.3.2. automation api](#232-automation-api)
- [3. äº§å“åŒ–æ€è·¯](#3-äº§å“åŒ–æ€è·¯)
	- [3.1. éœ€æ±‚](#31-éœ€æ±‚)
	- [3.2. ç ”å‘æ€è·¯](#32-ç ”å‘æ€è·¯)
	- [3.3. å¯é¢„è§é—®é¢˜](#33-å¯é¢„è§é—®é¢˜)
- [4. ä¸åŒç±»è½¯ä»¶å¯¹æ¯”](#4-ä¸åŒç±»è½¯ä»¶å¯¹æ¯”)
	- [4.1. ç›¸ä¼¼ç‚¹](#41-ç›¸ä¼¼ç‚¹)
	- [4.2. å·®å¼‚ç‚¹](#42-å·®å¼‚ç‚¹)
- [5. é™„å½•](#5-é™„å½•)
	- [5.1. é™„å½•1: ç®€å•ä½¿ç”¨ç¤ºä¾‹](#51-é™„å½•1-ç®€å•ä½¿ç”¨ç¤ºä¾‹)
		- [5.1.1. Tencent CLoud](#511-tencent-cloud)
			- [5.1.1.1. åˆå§‹åŒ–é¡¹ç›®](#5111-åˆå§‹åŒ–é¡¹ç›®)
			- [5.1.1.2. ç¼–å†™programä»£ç ](#5112-ç¼–å†™programä»£ç )
			- [5.1.1.3. å‡†å¤‡è¿è¡Œ](#5113-å‡†å¤‡è¿è¡Œ)
			- [5.1.1.4. è¿è¡Œåˆ›å»º](#5114-è¿è¡Œåˆ›å»º)
		- [5.1.2. OpenStack](#512-openstack)
			- [5.1.2.1. pulumié¡¹ç›®åˆ›å»º](#5121-pulumié¡¹ç›®åˆ›å»º)
			- [5.1.2.2. programä»£ç ç¼–å†™](#5122-programä»£ç ç¼–å†™)
			- [5.1.2.3. è¿è¡Œå‡†å¤‡](#5123-è¿è¡Œå‡†å¤‡)
			- [5.1.2.4. è¿è¡Œ](#5124-è¿è¡Œ)
- [6. å‚è€ƒ](#6-å‚è€ƒ)

<!-- /TOC -->

# 1. pulumiä»‹ç»

> githubé¡¹ç›®ä»‹ç»: Universal Infrastructure as Code. Your Cloud, Your Language, Your Way ğŸš€

é€šç”¨åŸºç¡€è®¾æ–½å³ä»£ç ï¼Œä½ äº‘ä½ ç´ ï¼Œç”¨ç†Ÿæ‚‰çš„æ–¹å¼ã€ç†Ÿæ‚‰çš„è¯­è¨€é€šè¿‡pulumiå»ç®¡ç†è‡ªå·±çš„äº‘å¹³å°ã€‚
é€šä¿—ç‚¹æ¥è¯´ï¼Œpulumiæ˜¯ä¸€ä¸ªåŸºç¡€è®¾æ–½èµ„æºç¼–æ’å™¨ï¼Œå†™å¥½ç¼–æ’ä»£ç ï¼Œä¾‹å¦‚å®šä¹‰çš„yamlã€æˆ–è€…ç¼–ç¨‹è¯­è¨€golangç­‰ï¼Œé€šè¿‡åŠ¨ä½œè§¦å‘å³èƒ½å®Œæˆå„ç§äº‘èµ„æºçš„å¢åˆ æ”¹æŸ¥ç­‰åŸºç¡€è®¾æ–½çš„ç®¡ç†ï¼Œä½¿ç”¨pulumiå¯ä»¥è½»æ¾æ„å»ºè‡ªå·±çš„å¤šäº‘å¹³å°ã€‚è¾ƒäºå·²æœ‰çš„ç¼–æ’å™¨ï¼Œpulumiæœ‰å¦‚ä¸‹å‡ ä¸ªæ˜æ˜¾çš„ç‰¹ç‚¹ã€‚

- é«˜å…¼å®¹æ€§
  - ç”¨æˆ·ä¾§ -- æ— éœ€å­¦ä¹ æ–°ç¼–ç¨‹è¯­è¨€
    - å‘½ä»¤è¡Œå·¥å…· `pulumi`
    - ä¸»æµè¯­è¨€sdk `Node.js` `Python` `Go` `.NET` `Java` `YAML`
  - äº‘ä¾§ -- å…¼å®¹ä¸»æµå‚å•†ä¸ä»£è¡¨æ€§å¼€æºè½¯ä»¶
    - AWS
    - Azure
    - Google Cloud
    - Kubernetes
    - OpenStack
    - é˜¿é‡Œäº‘
    - åä¸ºäº‘
    - è…¾è®¯äº‘
    - ...
- æŠ½è±¡ -- å„äº‘å‚å•†éƒ½æä¾›äº†è‡ªå·±çš„é©±åŠ¨ï¼Œä½œä¸ºä½¿ç”¨è€…æ— éœ€å¯¹æ¥äº‘å‚å•†sdkï¼Œä»…éœ€äº†è§£pulumiçš„é€šç”¨sdkå³å¯

# 2. pulumiè¿è¡Œæœºåˆ¶

## 2.1. æœ¯è¯­

- Project é¡¹ç›®ä¸ºstackçš„é›†åˆ
- Stack pulumiçš„æœåŠ¡ä¸»ä½“ã€æ‰€æœ‰æ“ä½œå›´ç»•stackå±•å¼€ï¼Œä¸€ä¸ªstackå¯ä»¥æœ‰å¤šä¸ªèµ„æºï¼Œäº§å“åŒ–è¿‡ç¨‹ä¸­ä¸€ä¸ªstackå¯¹åº”ä¸€ä¸ªresourceç›¸å¯¹æ¯”è¾ƒåˆç†
- Resource çœŸå®çš„äº‘èµ„æºï¼Œä¾‹å¦‚è…¾è®¯äº‘ä¸»æœºã€COSã€OpenStackå®ä¾‹ç­‰ç­‰
- Plugin äº‘å‚å•†æ’ä»¶ï¼Œresourceæ“ä½œæ—¶éœ€è¦è°ƒç”¨äº‘å‚å•†sdkï¼Œpluginåˆ™æ˜¯é’ˆå¯¹äº‘å‚å•†sdkçš„å°è£…ï¼Œä½¿ç”¨å‰éƒ½éœ€è¦å®‰è£…å¯¹åº”çš„æ’ä»¶ï¼Œä¾‹å¦‚awsèµ„æºéœ€è¦æå‰å®‰è£…awsæ’ä»¶
- Program å®é™…çš„èµ„æºæ“ä½œæ¨¡æ¿ï¼Œprogramä¼šè°ƒç”¨Pluginè¿›è¡Œèµ„æºæ“ä½œï¼Œè¢«stackè°ƒç”¨,ä½¿ç”¨è‡ªå·±ç†Ÿæ‚‰çš„è¯­è¨€ç¼–å†™ï¼Œå¯ä»¥é€šè¿‡pulumiå‘½ä»¤è§¦å‘
- Pulumiäº‘ç«¯ pulumiæœåŠ¡ä¸»ä½“æ˜¯stackï¼Œpulumièµ„æºçš„æ“ä½œå®é™…ä¸Šæ˜¯é€šè¿‡ä¿®æ”¹stackçŠ¶æ€æ¥å®Œæˆçš„ï¼ŒstackçŠ¶æ€å­˜å‚¨åœ¨pulumiäº‘ç«¯ï¼Œå­˜å‚¨æ–¹å¼å†³å®šäº† **è¦ä½¿ç”¨pulumiéœ€è¦ä¸https://www.pulumi.com/äº¤äº’ï¼Œæ“ä½œè®°å½•å­˜å‚¨åœ¨è¿™é‡Œè€Œä¸æ˜¯æœ¬åœ°**
- pulumi cli  pulumiå®¢æˆ·ç«¯å‘½ä»¤è¡Œï¼Œpulumiæ‰€æœ‰æ“ä½œéƒ½é€šè¿‡pulumiå‘½ä»¤å®Œæˆ
- pulumi automation API  pulumiå„è¯­è¨€sdkï¼Œæ˜¯å¯¹pulumiå‘½ä»¤çš„å°è£…

## 2.2. ç³»ç»Ÿæ¶æ„

![pulumi-programming-model-diagram](/img/posts/Pulumi%E6%9E%B6%E6%9E%84%E5%8F%8A%E4%BD%BF%E7%94%A8/pulumi-programming-model-diagram.svg)

è¿™å¼ å›¾è¯´æ˜äº† project program resource stackçš„å…³ç³»ï¼Œæ‰€æœ‰çš„èµ„æºéƒ½å±äºprojectï¼Œstackæ—¢å¯ä»¥è®¤ä¸ºæ˜¯å•ä¸ªèµ„æºçš„é€»è¾‘è¡¨ç¤ºï¼Œä¹Ÿèƒ½å½“ä½œç¯å¢ƒï¼Œprogramå¤„ç†å®é™…èµ„æºã€‚

## 2.3. é€»è¾‘æ¶æ„

![how-pulumi-works](/img/posts/Pulumiæ¶æ„åŠä½¿ç”¨/engine-block-diagram.png)

- Language Host æ‰§è¡Œprogramçš„æœåŠ¡å™¨ï¼Œå³æ‰§è¡Œè‡ªå®šä¹‰çš„ç¼–æ’ä»£ç çš„æœåŠ¡å™¨ï¼Œç”±è¯­è¨€ç¯å¢ƒï¼Œä¾‹å¦‚goã€pythonç­‰å’Œè¯­è¨€æ‰§è¡Œå™¨ä¸¤éƒ¨åˆ†ç»„æˆï¼Œè¯­è¨€ç¯å¢ƒè´Ÿè´£è¿è¡Œprogramï¼Œè¯­è¨€æ‰§è¡Œå™¨åˆ™æ˜¯pulumiå¦‚ä½•è°ƒç”¨ä¸åŒè¯­è¨€æ¥è¾¾æˆç‰¹å®šåŠ¨ä½œçš„å…³é”®ã€‚
- CLI and Engine CLIå³pulumi cliï¼ŒEngineä¸ºçŠ¶æ€æ£€æŸ¥å™¨ï¼Œä¾‹å¦‚è¦åˆ›å»ºStackæ—¶é¦–å…ˆè¦æ£€æŸ¥Stackå­˜ä¸å­˜åœ¨ï¼Œæ›´æ–°Stackæ—¶å¦‚æœå®é™…çŠ¶æ€å’Œç›®æ ‡çŠ¶æ€ä¸€è‡´åˆ™ä¸åšå¤„ç†ã€‚
- Last Deployed State æœ€åä¸€æ¬¡éƒ¨ç½²çŠ¶æ€ï¼Œå­˜å‚¨åœ¨pulumiäº‘ç«¯
- Provides å„äº‘å‚å•†çš„é©±åŠ¨ï¼ŒåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šresource plugin å’Œ SDK

è¦ä½¿ç”¨pulumiæœ‰å¦‚ä¸‹å‡ æ­¥ï¼Œä»¥pulumi cli æ“ä½œè…¾è®¯äº‘ä¸ºä¾‹:

- åˆå§‹åŒ– pulumié¡¹ç›® `pulumi new`
- é¦–å…ˆå†™å¥½åˆ›å»ºè™šæ‹Ÿæœºçš„ä»£ç ï¼Œè¿™éƒ¨åˆ†éµå¾ªpluginæ¨¡æ¿æ ¼å¼ï¼Œè°ƒç”¨è…¾è®¯äº‘æ’ä»¶sdk
- ä½¿ç”¨pulumi cliæˆ–è€… automation sdk è¿è¡Œç¼–æ’ä»£ç  `pulumi up` æˆ–è€… `auto.NewStackInlineSource->stack.Up`

### 2.3.1. pulumi cli ç¤ºä¾‹

é¦–å…ˆåˆå§‹åŒ–é¡¹ç›®

```bash
# åˆ›å»ºæ–‡ä»¶å¤¹
mkdir pulumi-qcloud
cd pulumi-qcloud
# åˆå§‹åŒ–é¡¹ç›®ï¼Œéœ€è¦ç™»é™†pulumiï¼Œé€‰æ‹©goæ¨¡æ¿å³å¯
pulumi new
```

ç¼–å†™programä»£ç 

```go
package main

import (
    "fmt"
    "github.com/pulumi/pulumi/sdk/v3/go/pulumi"
    "github.com/tencentcloudstack/pulumi-tencentcloud/sdk/go/tencentcloud/cos"
    "github.com/tencentcloudstack/pulumi-tencentcloud/sdk/go/tencentcloud/user"
)

func main() {
    pulumi.Run(func(ctx *pulumi.Context) error {
        _, err := user.GetInfo(ctx, nil, nil)
        if err != nil {
            fmt.Printf("the first error: %v\n", err)
            return err
        }
        _, err = cos.NewBucket(ctx, "myBucket", &cos.BucketArgs{
            Acl:    pulumi.String("private"),
            Bucket: pulumi.String(fmt.Sprintf("%v%v", "pulumi-created-", info.AppId)),
        })
        if err != nil {
            fmt.Printf("the second error: %v\n", err)
            return err
        }
        return nil
    })
}
```

è¿è¡Œ

```bash
pulumi up
```

### 2.3.2. automation api

![automation-api](/img/posts/Pulumi%E6%9E%B6%E6%9E%84%E5%8F%8A%E4%BD%BF%E7%94%A8/automation-api.png)

automation apiæ˜¯å¯¹pulumi cliçš„å°è£…ï¼Œé€šè¿‡automation apiè°ƒç”¨æ›´ç®€å•: sdkæ“ä½œæ¯”è°ƒç”¨äºŒè¿›åˆ¶æ–¹ä¾¿ï¼Œæ›´å®‰å…¨: ä¸ç”¨ç›´æ¥ä¸æ–‡ä»¶ç³»ç»Ÿæ–‡ä»¶è¿›è¡Œç›´æ¥è®¿é—®ã€‚
pulumi ä¸ç»å¯ä»¥é€šè¿‡ rest apiæ–¹å¼ã€cliæ–¹å¼æä¾›ä½¿ç”¨ï¼Œè¿˜èƒ½ç»§æ‰¿å¸¦ci/cdç³»ç»Ÿä¸­ï¼Œæ–¹ä¾¿CDã€‚

ä½¿ç”¨rest apiæ–¹å¼æä¾›æœåŠ¡è§ [pulumi_over_http](https://github.com/pulumi/automation-api-examples/tree/main/go/pulumi_over_http)

è…¾è®¯äº‘ rest apiç¤ºä¾‹ [multistack-example](https://github.com/elrondwong/multistack-example)

# 3. äº§å“åŒ–æ€è·¯

## 3.1. éœ€æ±‚

- ç®¡ç†å¤šäº‘
- ç®¡ç†æ··åˆäº‘
- ä¸éœ€è¦è‡ªå·±å†™sdk
- å¯ç§æœ‰åŒ–
- ä»¥rest apiæ–¹å¼æä¾›æœåŠ¡

å…¶ä¸­å¯ç§æœ‰åŒ–ä¸èƒ½æ»¡è¶³ï¼Œå› ä¸ºæ“ä½œè®°å½•éƒ½ä¼šå­˜å‚¨åœ¨pulumiäº‘ç«¯ï¼Œå…¶ä»–å‡æ»¡è¶³ï¼Œå¦‚æœå¿½ç•¥è¿™ç‚¹ï¼Œpulumiå¯ç§°ä¸ºå®Œç¾çš„å¤šäº‘ç®¡ç†åˆ©å™¨

## 3.2. ç ”å‘æ€è·¯

- projectä½œä¸ºèµ„æºéš”ç¦»å•ä½
- ä¸€ä¸ªstackä¸ºä¸€ä¸ªèµ„æºï¼Œèµ„æºçš„æ‰€æœ‰å¢åˆ æ”¹æŸ¥éƒ½é€šè¿‡stackæ“ä½œ
- ä½¿ç”¨automation apiåµŒå…¥å·²ç”±ä¸šåŠ¡ä»£ç  [demo](https://github.com/elrondwong/multistack-example)

## 3.3. å¯é¢„è§é—®é¢˜

- pulumi è¾“å‡ºå¤§éƒ½åœ¨æ–‡ä»¶ä¸­ï¼Œéœ€è¦è¯»å–æ–‡ä»¶è§£æ
- pulumi ä¸èƒ½ç›´æ¥åˆ—ä¸¾èµ„æºï¼Œä¾‹å¦‚è·å–ä¸€ä¸ªprojectçš„æ‰€æœ‰èµ„æºï¼Œéœ€å…ˆåˆ—ä¸¾projectçš„stackï¼Œåœ¨åˆ—è§‰stackä¸­çš„èµ„æºï¼Œåœ¨é€šè¿‡èµ„æºgetæ¥å£getèµ„æºä¿¡æ¯
- pulumi æœ¬èº«æ—¥å¿—è¾“å‡ºæ ¼å¼æ¯”è¾ƒèŠ±é‡Œèƒ¡å“¨ï¼Œé€‚åˆäººç±»ç›´æ¥è¯»ï¼Œä½†ç»“æ„åŒ–å·®ä¸é€‚åˆåˆ†æ
- pulumi æ–‡æ¡£å’Œç¤ºä¾‹è¾ƒå°‘

# 4. ä¸åŒç±»è½¯ä»¶å¯¹æ¯”

å¯¹æ¯”æœ€å¤šçš„ä¸ºterraform

## 4.1. ç›¸ä¼¼ç‚¹

- éƒ½æ˜¯IaC
- éƒ½å¼€æº
- éƒ½æä¾›æœŸæœ›èµ„æºçŠ¶æ€ç®¡ç†æ¨¡å‹
- éƒ½æ”¯æŒä¸»æµäº‘å‚å•†
- éƒ½å¾ˆæµè¡Œï¼Œå¤‡å—å‚å•†é’ç

## 4.2. å·®å¼‚ç‚¹

è¿™é‡Œä»…åˆ—ä¸¾äº†å‡ ä¸ªåœ¨é€‰å‹ä¸­èµ·å†³å®šæ€§å› ç´ çš„å·®å¼‚ç‚¹ï¼Œè¯¦ç»†çš„å¯¹æ¯”å‚ç…§ [Pulumi vs. Terraform](https://www.pulumi.com/docs/intro/vs/terraform/)

|åŠŸèƒ½|pulumi|Terraform|
|:-:|:-:|:-:|
|è¯­è¨€æ”¯æŒ|Python, TypeScript, JavaScript, Go, C#, F#, Java, YAML|HashiCorp Configuration Language (HCL)|
|IDEæ”¯æŒ|ä»£ç è¡¥é½ã€å¼ºç±»å‹ã€é”™è¯¯æç¤ºã€ä¸°å¯Œçš„èµ„æºæ–‡æ¡£|å—é™|
|çŠ¶æ€ç®¡ç†|å¯è§†åŒ–çŠ¶æ€ç®¡ç†|åŠŸèƒ½å¼±ã€å¯è§†åŒ–æ”¯æŒå·®|
|åµŒå…¥ä¸šåŠ¡ä»£ç |å¯åµŒå…¥|ä¸å¯åµŒå…¥|
|secretsç®¡ç†|æœ‰|æ— |

æœ€å¤§çš„åŒºåˆ«åœ¨äºè¯­è¨€æ”¯æŒã€çŠ¶æ€ç®¡ç†ã€å¯åµŒå…¥ä¸šåŠ¡ä»£ç ä¸­ä¸‰ç‚¹

- terraforméœ€è¦å­¦ä¹ hclï¼Œpulumiåˆ™æ”¯æŒå¤šç§è¯­è¨€ï¼Œé€‰æ‹©é¡ºæ‰‹çš„è¯­è¨€æ“ä½œå³å¯ï¼Œæ— è¯­è¨€å­¦ä¹ æˆæœ¬
- pulumiæä¾›äº†å®Œå¤‡çš„çŠ¶æ€ç®¡ç†ï¼Œä¸”åœ¨äº‘ç«¯å¯è§†åŒ–ï¼ŒterraformçŠ¶æ€ç®¡ç†åˆ™æ”¯æŒéå¸¸ä¸å®Œå–„
- terraformä¸èƒ½åµŒå…¥åˆ°ä¸šåŠ¡ä»£ç ä¸­ï¼Œåªèƒ½ä½œä¸ºè¿ç»´å·¥å…·ä½¿ç”¨ï¼Œpulumiåˆ™å¯ä»¥å®Œç¾åµŒå…¥

# 5. é™„å½•

## 5.1. é™„å½•1: ç®€å•ä½¿ç”¨ç¤ºä¾‹

### 5.1.1. Tencent CLoud

#### 5.1.1.1. åˆå§‹åŒ–é¡¹ç›®

```bash
â¯ pulumi new --force
Please choose a template (113/205 shown):
 go                                 A minimal Go Pulumi program
This command will walk you through creating a new Pulumi project.

Enter a value or leave blank to accept the (default), and press <ENTER>.
Press ^C at any time to quit.

project name: (pulumitest)
project description: (A minimal Go Pulumi program)
Created project 'pulumitest'

Please enter your desired stack name.
To create a stack in an organization, use the format <org-name>/<stack-name> (e.g. `acmecorp/dev`).
stack name: (dev)
Created stack 'dev'

Installing dependencies...

go: downloading github.com/pulumi/pulumi/sdk/v3 v3.53.0
go: finding module for package github.com/mattn/go-isatty
go: found github.com/mattn/go-isatty in github.com/mattn/go-isatty v0.0.17
Finished installing dependencies

Your new project is ready to go! âœ¨

To perform an initial deployment, run `pulumi up`
```

#### 5.1.1.2. ç¼–å†™programä»£ç 

```go
package main

import (
    "fmt"
    "github.com/pulumi/pulumi/sdk/v3/go/pulumi"
    "github.com/tencentcloudstack/pulumi-tencentcloud/sdk/go/tencentcloud/cos"
    "github.com/tencentcloudstack/pulumi-tencentcloud/sdk/go/tencentcloud/user"
)

func main() {
    pulumi.Run(func(ctx *pulumi.Context) error {
        _, err := user.GetInfo(ctx, nil, nil)
        if err != nil {
            fmt.Printf("the first error: %v\n", err)
            return err
        }
        _, err = cos.NewBucket(ctx, "myBucket", &cos.BucketArgs{
            Acl:    pulumi.String("private"),
            Bucket: pulumi.String(fmt.Sprintf("%v%v", "pulumi-created-", info.AppId)),
        })
        if err != nil {
            fmt.Printf("the second error: %v\n", err)
            return err
        }
        return nil
    })
}
```

#### 5.1.1.3. å‡†å¤‡è¿è¡Œ

- é…ç½®è…¾è®¯äº‘å‡­è¯

```bash
â¯ pulumi config set tencentcloud:secretId xxxxx --secret
â¯ pulumi config set tencentcloud:secretKey xxxxxxx --secret
â¯ pulumi config set tencentcloud:region ap-hongkong
```

- ä¸‹è½½sdkä¾èµ–åŒ…

```bash
â¯ go mod tidy
go: finding module for package github.com/tencentcloudstack/pulumi-tencentcloud/sdk/go/tencentcloud/cos
go: finding module for package github.com/tencentcloudstack/pulumi-tencentcloud/sdk/go/tencentcloud/user
go: found github.com/tencentcloudstack/pulumi-tencentcloud/sdk/go/tencentcloud/cos in github.com/tencentcloudstack/pulumi-tencentcloud/sdk v0.1.2
go: found github.com/tencentcloudstack/pulumi-tencentcloud/sdk/go/tencentcloud/user in github.com/tencentcloudstack/pulumi-tencentcloud/sdk v0.1.2
```

#### 5.1.1.4. è¿è¡Œåˆ›å»º

> å¯ä»¥æå‰å®‰è£…pluginï¼Œå¦åˆ™è¿è¡Œpulumi upçš„æ—¶å€™ä¼šå®‰è£…ï¼Œå‘½ä»¤ä¸º `pulumi plugin install resource tencentcloud v0.1.2`, ä¸ç¿»å¢™çš„è¯å¾ˆæ…¢

```bash
â¯ pulumi up
Previewing update (dev)

View Live: https://app.pulumi.com/elrondwong/pulumitest/dev/previews/f129cbae-67d8-42aa-b78a-c082e598a08f

# å®‰è£…plugin
Downloading plugin: 21.15 MiB / 43.45 MiB [==========>-----------]  48.67% 18m8s
Downloading plugin: 43.45 MiB / 43.45 MiB [=====================] 100.00% 37m32s
                                                                                [resource plugin tencentcloud-0.1.2] installing
     Type                        Name            Plan       
     pulumi:pulumi:Stack         pulumitest-dev             
 +   â””â”€ tencentcloud:Cos:Bucket  myBucket        create     


Resources:
    + 1 to create
    1 unchanged

Do you want to perform this update? yes
Updating (dev)

View Live: https://app.pulumi.com/elrondwong/pulumitest/dev/updates/2

     Type                        Name            Status           
     pulumi:pulumi:Stack         pulumitest-dev                   
 +   â””â”€ tencentcloud:Cos:Bucket  myBucket        created (4s)     


Resources:
    + 1 created
    1 unchanged

Duration: 11s
```

è¿™é‡Œä»…å±•ç¤ºäº†èµ„æºåˆ›å»ºï¼Œå¯¹èµ„æºçš„é”€æ¯å¯ä»¥çœ‹ä¸‹é¢OpenStackçš„ä¾‹å­

### 5.1.2. OpenStack

#### 5.1.2.1. pulumié¡¹ç›®åˆ›å»º

```bash
 pulumi new --dir pulumiopenstack
Please choose a template (113/205 shown):
 openstack-go                       A minimal OpenStack Go Pulumi program
This command will walk you through creating a new Pulumi project.

Enter a value or leave blank to accept the (default), and press <ENTER>.
Press ^C at any time to quit.

project name: (pulumiopenstack)
project description: (A minimal OpenStack Go Pulumi program)
Created project 'pulumiopenstack'

Please enter your desired stack name.
To create a stack in an organization, use the format <org-name>/<stack-name> (e.g. `acmecorp/dev`).
stack name: (dev)
Created stack 'dev'

Installing dependencies...

Finished installing dependencies

Your new project is ready to go! âœ¨

To perform an initial deployment, run 'cd pulumiopenstack', then, run `pulumi up`
```

#### 5.1.2.2. programä»£ç ç¼–å†™

```go
package main

import (
    "fmt"
    "github.com/pulumi/pulumi-openstack/sdk/v3/go/openstack/blockstorage"
    "github.com/pulumi/pulumi/sdk/v3/go/pulumi"
)

func main() {
    pulumi.Run(func(ctx *pulumi.Context) error {
      _, err := blockstorage.NewVolume(ctx, "volume1", &blockstorage.VolumeArgs{
          Description: pulumi.String("first test volume"),
          Region:      pulumi.String("RegionOne"),
          Size:        pulumi.Int(3),
      })
      if err != nil {
          return err
      }
      return nil
    })
}
```

#### 5.1.2.3. è¿è¡Œå‡†å¤‡

- å®‰è£…plugin

```bash
pulumi plugin install resource openstack v3.9.0
```

- å®‰è£…ä¾èµ–åŒ…

```bash
go mod tidy
```

- é…ç½®å‡­è¯

```bash
export OS_USERNAME=admin
export OS_PASSWORD=passwd
export OS_PROJECT_NAME=admin
export OS_USER_DOMAIN_NAME=Default
export OS_PROJECT_DOMAIN_NAME=Default
export OS_AUTH_URL=http://172.16.10.10:5000/v3
export OS_IDENTITY_API_VERSION=3
export PS1='[\u@\h \W(keystone_admin)]\$ '
```

#### 5.1.2.4. è¿è¡Œ

- åˆ›å»ºå·

```bash
â¯ pulumi up
Previewing update (dev)

View Live: https://app.pulumi.com/elrondwong/pulumiopenstack/dev/previews/cc39ba12-d292-43ad-b962-a9d5d66653a5

Downloading plugin openstack v3.9.0: 17.95 MiB / 17.95 MiB [=====] 100.00% 7m24s
     Type                              Name                 Plan
 +   pulumi:pulumi:Stack               pulumiopenstack-dev  create
 +   â””â”€ openstack:blockstorage:Volume  volume1              create


Resources:
    + 2 to create

Do you want to perform this update? yes
Updating (dev)

View Live: https://app.pulumi.com/elrondwong/pulumiopenstack/dev/updates/1

     Type                              Name                 Status
 +   pulumi:pulumi:Stack               pulumiopenstack-dev  created (0.62s)
 +   â””â”€ openstack:blockstorage:Volume  volume1              created (11s)


Resources:
    + 2 created

Duration: 15s
```

- é”€æ¯èµ„æº

```bash
â¯ pulumi destroy
Previewing destroy (dev)

View Live: https://app.pulumi.com/elrondwong/pulumiopenstack/dev/previews/4673ac44-90a7-438a-8166-01e7cdf1f89d

     Type                              Name                 Plan
 -   pulumi:pulumi:Stack               pulumiopenstack-dev  delete
 -   â””â”€ openstack:blockstorage:Volume  volume1              delete


Resources:
    - 2 to delete

Do you want to perform this destroy? yes
Destroying (dev)

View Live: https://app.pulumi.com/elrondwong/pulumiopenstack/dev/updates/2

     Type                              Name                 Status
 -   pulumi:pulumi:Stack               pulumiopenstack-dev  deleted
 -   â””â”€ openstack:blockstorage:Volume  volume1              deleted (11s)


Resources:
    - 2 deleted

Duration: 13s

The resources in the stack have been deleted, but the history and configuration associated with the stack are still maintained.
If you want to remove the stack completely, run `pulumi stack rm dev`.
```

- é”€æ¯stack

```bash
â¯ pulumi stack rm dev
This will permanently remove the 'dev' stack!
Please confirm that this is what you'd like to do by typing `dev`: dev
Stack 'dev' has been removed!

# https://app.pulumi.com/elrondwong/projects 
stacké‡Œé¢å°‘äº†ä¸€ä¸ª
```

# 6. å‚è€ƒ

- [how-pulumi-works](https://www.pulumi.com/docs/intro/concepts/how-pulumi-works/)
- [hello-pulumi](http://joeduffyblog.com/2018/06/18/hello-pulumi/)
- [Pulumi vs. Terraform](https://www.pulumi.com/docs/intro/vs/terraform/)
- [pulumi-tencentcloud](https://github.com/tencentcloudstack/pulumi-tencentcloud)
- [pulumi-openstack](https://github.com/pulumi/pulumi-openstack)
- [automation-api-examples](https://github.com/pulumi/automation-api-examples)